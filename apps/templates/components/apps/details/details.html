{% block appdetails %}
    <link href="{{ static('components/apps/details/app-details.css') }}" rel="stylesheet">
    <body class="bg-light">

    <nav class="navbar navbar-expand-md navbar-dark sticky-top bg-dark">
        <a class="navbar-brand" href="#">Wharf</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse"
                data-target="#main-nav-bar-apps-list" aria-controls="main-nav-bar-apps-list"
                aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="main-nav-bar-apps-list">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="{{ url('index') }}">Home <span class="sr-only">(current)</span></a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <main role="main" class="col-md-12 ml-sm-auto col-lg-12 pt-3 px-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
                    <a href="{{ url('index') }}"><span>&#8592;</span>Return to apps list</a>
                    <h2 class="h2">Wharf: {{ app }}</h2>
                </div>

                <div class="row">
                    <div class="col-sm-6">
                        <h3>Actions</h3>
                        <div class="card">
                        <div class="card-header">
                            Status
                        </div>
                        <div class="card-body">
                            {% if git_url == None %}
                                <h4 class="card-title">Can't deploy due to missing GITHUB_URL in config (which should be set to the "Clone with HTTPS" url from Github)</h4>
                            {% else %}
                                <h4 class="card-title">The current deploy URL is:</h4>
                                <p class="card-text"><a href="{{ git_url }}" rel="nofollow noopener noreferrer" target="_blank">{{ git_url }}</a></p>
                                <form class="form-inline" action="{{ url('deploy', app_name=app) }}" method="POST">
                                    {% csrf_token %}
                                    <input type="hidden" name="url" value="{{ git_url }}" />
                                    <button type="submit" class="btn btn-outline-primary btn-deploy-app"  name="action" value="deploy">Deploy app</button>
                                    <button type="submit" class="btn btn-outline-warning btn-rebuild-app" name="action" value="rebuild">Rebuild app</button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                    </div>
                    <div class="col-sm-6">
                        <h3>Task logs</h3>
                        <div class="card">
                            <div class="card-header">
                                Status
                            </div>
                            <div class="card-body">
                                {% if task_logs %}
                                    <ul>
                                        {% for tl in task_logs %}
                                            <li><a href="{{ url('show_log', task_id=tl.task_id) }}">{{ tl.nice_when() }} - {{ tl.description }}</a></li>
                                        {% endfor %}
                                    </ul>
                                {% else %}
                                    <h5 class="card-title">No tasks to run yet</h5>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                <br><br>

                <div class="row">
                    <div class="col-sm-4">
                        <h3>Process Info</h3>
                        <div class="card">
                            <div class="card-header">
                                Status
                            </div>
                            <div class="card-body">
                                <ul>
                                    {% for (k,v) in process.items() if k!= 'processes' %}
                                        <li>{{k}}: {{v}}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <h3>Let's Encrypt</h3>
                        <div class="card">
                            <div class="card-header">
                                Status
                            </div>
                            <div class="card-body">
                                {% if letsencrypt %}
                                    <ul>
                                        {% for (k,v) in letsencrypt.items() if k != 'App name' %}
                                            <li>{{k}}: {{v}}</li>
                                        {% endfor %}
                                    </ul>
                                {% else %}
                                    <form class="form-inline" action="{{ url('setup_letsencrypt', app_name=app) }}" method="POST">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-primary">Setup Let's Encrypt</button>
                                    </form>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <h3>Processes</h3>
                        <div class="card">
                            <div class="card-header">
                                Status
                            </div>
                            <div class="card-body">
                                <ul>
                                    {% for (k,v) in process['processes'].items() %}
                                        <li>{{k}}: {{v}}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <br><br>

                <h3>Domains</h3>
                <ul id="app-domains" class="nav nav-tabs">
                    <li class="nav-item"><a href="" data-target="#app-domains-list" data-toggle="tab" class="nav-link small text-uppercase active show">Domains for this app</a></li>
                    <li class="nav-item"><a href="" data-target="#app-domain-add" data-toggle="tab" class="nav-link small text-uppercase">Add new item</a></li>
                </ul>
                <br>
                <div id="tabAppDomainsContent" class="tab-content">
                    <div id="app-domains-list" class="tab-pane fade active show">
                        {% if domains.lenght == 0 %}
                            <h4>No domains associated with this app.</h4>
                        {% else %}
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered">
                                    <thead>
                                        <tr>
                                            <th scope="col">Name</th>
                                            <th scope="col">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for domain in domains %}
                                        <tr>
                                            <td><a href="{{ 'https' if letsencrypt else 'http' }}://{{ domain }}" rel="nofollow noopener noreferrer" target="_blank">{{ domain }}</a></td>
                                            <td>
                                                <form class="d-inline" action="{{ url('remove_domain', app_name=app) }}" method="POST">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="name" value="{{domain}}" />
                                                    <button type="submit" class="btn btn-outline-danger">Delete '{{domain}}' domain</button>
                                                </form>
                                            </td>
                                        </tr>
                                        {% else %}
                                        <tr>
                                            <td>No domains to list</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% endif %}
                    </div>
                    <div id="app-domain-add" class="tab-pane fade">
                        <h4>Add a new domain for this app</h4>
                        <form action="{{ url('add_domain', app_name=app) }}" method="POST">
                            {% csrf_token %}
                            {{ domain_form | bootstrap }}
                            <input class="btn btn-lg btn-block btn-outline-primary" type="submit" value="Submit" />
                        </form>
                    </div>
                </div>
                <br><br>

                <h3>App environment config</h3>
                <ul id="app-env-config" class="nav nav-tabs">
                    <li class="nav-item"><a href="" data-target="#app-config-list" data-toggle="tab" class="nav-link small text-uppercase active show">Configuration list for this app</a></li>
                    <li class="nav-item"><a href="" data-target="#app-config-add" data-toggle="tab" class="nav-link small text-uppercase">Add new item</a></li>
                </ul>
                <br>
                <div id="tabAppDomainsContent" class="tab-content">
                    <div id="app-config-list" class="tab-pane fade active show">
                        <div class="list-group">
                            {% for (k,v) in config %}
                                <span class="text-muted list-group-item d-inline-block"><span>{{ k }}</span> = {{ v }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    <div id="app-config-add" class="tab-pane fade">
                        <h4>Add a new config for this app</h4>
                        <form action="{{ url('app_info', app_name=app) }}" method="POST">
                            {% csrf_token %}
                            {{ form | bootstrap }}
                            <input class="btn btn-lg btn-block btn-outline-primary" type="submit" value="Submit" />
                        </form>
                    </div>
                </div>
                <br><br>

            </main>
        </div>
    </div>

    <h3>Postgres</h3>
    {% if postgres %}
        Status: {{ postgres['STATUS'] }}
    {% else %}
        <form class="form-inline" action="{{ url('create_postgres', app_name=app) }}" method="POST">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary">Create postgres db</button>
        </form>
    {% endif %}
    <h3>Redis</h3>
    {% if redis %}
        Status: {{ redis['STATUS'] }}
    {% else %}
        <form class="form-inline" action="{{ url('create_redis', app_name=app) }}" method="POST">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary">Create redis db</button>
        </form>
    {% endif %}



    <h3>Logs</h3>
    <pre>
{{ logs }}
</pre>
    </body>
{% endblock %}